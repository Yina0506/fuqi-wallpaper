<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ç¦æ°”ç ”ç©¶æ‰€ Â· çµæ„Ÿå£çº¸</title>
<style>
/* ... ä¿ç•™ä½ åŸæœ‰çš„ CSS ... */
/* æ–°å¢ï¼šéŸ³ä¹ä¸æŠ½ç­¾æ ·å¼ */
.plugin-bar {
    display: flex; justify-content: center; gap: 15px; padding: 10px; flex-wrap: wrap;
}
.plugin-btn {
    background: #fff; border: 1.5px solid #ffb07a; padding: 8px 15px;
    border-radius: 50px; cursor: pointer; font-size: 0.85rem; color: #c0380a;
    display: flex; align-items: center; gap: 6px; transition: all 0.3s;
}
.plugin-btn:hover { background: #ffb07a; color: white; }

/* æŠ½ç­¾å¼¹çª—æ ·å¼ */
#draw-overlay {
    display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8);
    z-index: 1000; align-items: center; justify-content: center; flex-direction: column;
}
.stick-container { width: 80px; height: 120px; background: #c0380a; border-radius: 10px; position: relative; animation: shake 0.5s infinite; display: none;}
@keyframes shake {
    0% { transform: rotate(0deg); } 25% { transform: rotate(10deg); }
    50% { transform: rotate(0deg); } 75% { transform: rotate(-10deg); } 100% { transform: rotate(0deg); }
}
.stick-result { 
    background: #fff8f0; padding: 30px; border-radius: 20px; text-align: center;
    max-width: 280px; border: 4px solid #c0380a;
}

/* ä¿®å¤æœç´¢ï¼šåŠ è½½åŠ¨ç”»åœ¨ç§»åŠ¨ç«¯æ›´æ˜¾çœ¼ */
.loading { font-weight: bold; background: rgba(255,255,255,0.8); border-radius: 10px; margin: 10px auto; width: fit-content; padding: 15px 30px; }
</style>
</head>
<body>

<header>
  <div class="logo">ç¦æ°”ç ”ç©¶æ‰€</div>
  <div class="sub">âœ¦ æ‰‹æœºå£çº¸çµæ„Ÿåº“ âœ¦</div>
</header>

<div class="plugin-bar">
    <select id="bgm-player" class="plugin-btn" onchange="changeMusic()">
        <option value="">ğŸµ é€‰æ‹©èƒŒæ™¯éŸ³ä¹</option>
        <option value="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3">æ¸…ä¿®ç¦…éŸ³</option>
        <option value="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3">é«˜å±±æµæ°´</option>
        <option value="https://assets.mixkit.co/music/preview/mixkit-zen-meditation-431.mp3">å†¥æƒ³ç™½å™ª</option>
    </select>
    <button class="plugin-btn" onclick="startDraw()">ğŸ‹ æ¯æ—¥æŠ½ç­¾ (ç›²ç›’)</button>
</div>

<div class="search-wrap">
  <div class="search-row">
    <input id="kw" type="text" placeholder="è¾“å…¥å…³é”®è¯ï¼Œå¦‚ 'æå…‰' æˆ– 'æ‹›è´¢çŒ«'"/>
    <button onclick="doSearch()">ç”Ÿæˆ</button>
  </div>
  <div class="tags" id="tags"></div>
</div>

<div class="loading" id="loading">
  <div class="spinner"></div>
  æ­£åœ¨å¬å”¤å¥½è¿...ï¼ˆAIç”Ÿæˆçº¦éœ€5-10ç§’ï¼‰
</div>

<div class="gallery" id="gallery"></div>

<div id="draw-overlay" onclick="this.style.display='none'">
    <div class="stick-container" id="stick-box"></div>
    <div class="stick-result" id="stick-result" style="display:none">
        <h2 style="color:#c0380a; margin-bottom:10px;">ä¸Šä¸Šç­¾</h2>
        <p id="luck-text" style="font-size:1.1rem; color:#5a2a10;"></p>
        <p style="font-size:0.8rem; color:#e07030; margin-top:15px;">å·²ä¸ºä½ è‡ªåŠ¨å¬å”¤ç›¸å…³å£çº¸ âœ¨</p>
    </div>
</div>

<audio id="audio-element" loop></audio>

<script>
// ... è¿™é‡Œä¿ç•™ä½ åŸæœ‰çš„ TAGS æ•°ç»„ ...
const TAGS = [ /* åŒåŸä»£ç  */ ];

// 1. ä¿®å¤æœç´¢é€»è¾‘
function doSearch() {
    const kwInput = document.getElementById('kw');
    const kw = kwInput.value.trim();
    if (!kw) return;

    // é€»è¾‘ä¿®æ­£ï¼šä¼˜å…ˆåŒ¹é…é¢„è®¾ Prompt
    const matchedTag = TAGS.find(t => t.label.toLowerCase().includes(kw.toLowerCase()));
    const finalPrompt = matchedTag ? matchedTag.prompt : `${kw}, auspicious Chinese style, aesthetic, phone wallpaper, 4k`;
    
    // è§†è§‰åé¦ˆï¼šæ›´æ–°æ ‡ç­¾çŠ¶æ€
    document.querySelectorAll('.tag').forEach(t => {
        t.classList.toggle('active', t.textContent === kw);
    });

    generate(finalPrompt, kw);
}

// 2. ä¼˜åŒ–ç”Ÿæˆå‡½æ•°
async function generate(prompt, label) {
    const loading = document.getElementById('loading');
    const gallery = document.getElementById('gallery');
    
    loading.style.display = 'block';
    gallery.style.opacity = '0.3'; // æœç´¢æ—¶èƒŒæ™¯å˜æš—ï¼Œæå‡åé¦ˆæ„Ÿ

    const fullPrompt = encodeURIComponent(prompt + ", high quality, masterpiece, 9:16 aspect ratio, no text");
    const newImages = [];

    // ä½¿ç”¨ Promise.all å¹¶è¡ŒåŠ è½½ï¼ˆè™½ç„¶APIæ˜¯å¼‚æ­¥ï¼Œä½†è¿™æ ·é€»è¾‘æ›´ç¨³ï¼‰
    for (let i = 0; i < 4; i++) { // å…ˆç”Ÿæˆ4å¼ ä»¥ä¿è¯é€Ÿåº¦
        const seed = Math.floor(Math.random() * 1000000);
        const url = `https://image.pollinations.ai/prompt/${fullPrompt}?width=1080&height=1920&seed=${seed}&nologo=true`;
        newImages.push({ url, seed, label });
    }

    // æ¨¡æ‹Ÿä¸€ä¸ªåŠ è½½è¿‡ç¨‹ç¡®ä¿å›¾ç‰‡åœ°å€å·²åˆ†å‘
    setTimeout(() => {
        currentImages = newImages;
        loading.style.display = 'none';
        gallery.style.opacity = '1';
        renderGallery();
    }, 500);
}

// 3. éŸ³ä¹é€‰æ‹©æ’ä»¶é€»è¾‘
function changeMusic() {
    const player = document.getElementById('audio-element');
    const select = document.getElementById('bgm-player');
    if (select.value) {
        player.src = select.value;
        player.play();
    } else {
        player.pause();
    }
}

// 4. æŠ½ç­¾ï¼ˆç›²ç›’ï¼‰æ’ä»¶é€»è¾‘
const LUCK_QUOTES = [
    { text: "é‡‘é¾™è…¾äº‘ï¼šè´¢è¿äº¨é€š", tag: "ğŸ‰ Golden Dragon" },
    { text: "é”¦é²¤ç¿»èº«ï¼šå¥½è¿è¿è¿", tag: "ğŸ”´ Lucky Koi" },
    { text: "æ¡ƒèŠ±æœµæœµï¼šç¼˜åˆ†å°†è‡³", tag: "ğŸŒ¸ Peach Blossom" },
    { text: "ç«¹æŠ¥å¹³å®‰ï¼šå²å²æ¸…æ¬¢", tag: "ğŸ‹ Bamboo Luck" }
];

function startDraw() {
    const overlay = document.getElementById('draw-overlay');
    const box = document.getElementById('stick-box');
    const result = document.getElementById('stick-result');
    
    overlay.style.display = 'flex';
    box.style.display = 'block';
    result.style.display = 'none';

    // åŠ¨ç”» 1.5 ç§’åå‡ºç»“æœ
    setTimeout(() => {
        box.style.display = 'none';
        const luckyOne = LUCK_QUOTES[Math.floor(Math.random() * LUCK_QUOTES.length)];
        document.getElementById('luck-text').innerText = luckyOne.text;
        result.style.display = 'block';
        
        // è‡ªåŠ¨è§¦å‘æœç´¢
        document.getElementById('kw').value = luckyOne.tag;
        doSearch();
    }, 1500);
}

// ... ä¿ç•™ä½ åŸæœ‰çš„ renderGallery, openLb, closeLb å‡½æ•° ...
</script>
</body>
</html>
