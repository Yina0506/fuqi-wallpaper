<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ç¦æ°”ç ”ç©¶æ‰€ Â· æ‰‹æœºå£çº¸</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Georgia', serif;
  background: linear-gradient(135deg, #fff8f0 0%, #ffe8d0 50%, #fff0e8 100%);
  min-height: 100vh;
  color: #5a2a10;
}
header {
  text-align: center;
  padding: 32px 20px 16px;
}
header .logo-text {
  font-size: 2rem; font-weight: 900;
  color: #c0380a; letter-spacing: 6px;
  text-shadow: 0 2px 8px #ffcc8060;
}
header .tagline { margin-top: 6px; font-size: 0.82rem; color: #e07030; letter-spacing: 3px; }

.source-tabs {
  display: flex; justify-content: center;
  gap: 10px; padding: 12px 20px 0; flex-wrap: wrap;
}
.src-tab {
  padding: 7px 18px; border-radius: 50px;
  border: 2px solid #ffb07a; background: #fff8f0;
  color: #c0380a; font-size: 0.8rem; cursor: pointer;
  transition: all 0.2s; letter-spacing: 1px;
}
.src-tab.active { background: #c0380a; color: #ffd740; border-color: #c0380a; font-weight: bold; }
.src-tab:hover:not(.active) { background: #fff0e0; }
.source-badge {
  display: inline-block; font-size: 0.65rem;
  padding: 2px 8px; border-radius: 50px; margin-left: 4px; font-weight: bold;
}
.badge-ai    { background: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }
.badge-wiki  { background: #e3f2fd; color: #1565c0; border: 1px solid #90caf9; }
.badge-pexels{ background: #fce4ec; color: #880e4f; border: 1px solid #f48fb1; }

.search-section {
  display: flex; flex-direction: column;
  align-items: center; padding: 18px 20px 12px; gap: 12px;
}
.search-row { display: flex; gap: 10px; width: 100%; max-width: 600px; }
.search-row input {
  flex: 1; padding: 13px 20px;
  border: 2px solid #ffb07a; border-radius: 50px;
  font-size: 0.95rem; background: #fffaf5;
  color: #5a2a10; outline: none; transition: border 0.2s;
}
.search-row input:focus { border-color: #e8190a; }
.search-row button {
  padding: 13px 24px;
  background: linear-gradient(135deg, #ff6b35, #e8190a);
  color: #ffd740; border: none; border-radius: 50px;
  font-size: 0.95rem; font-weight: bold; cursor: pointer;
  box-shadow: 0 4px 14px #e8190a40; transition: transform 0.15s;
}
.search-row button:hover { transform: translateY(-2px); }

.tag-row { display: flex; flex-wrap: wrap; gap: 7px; justify-content: center; max-width: 640px; }
.tag {
  padding: 5px 14px; border-radius: 50px;
  background: #fff3e0; border: 1.5px solid #ffb07a;
  color: #c0380a; font-size: 0.78rem; cursor: pointer;
  transition: all 0.2s; letter-spacing: 1px;
}
.tag:hover, .tag.active { background: #e8190a; color: #ffd740; border-color: #e8190a; }

.mode-toggle { display: flex; justify-content: center; margin: 4px 0; }
.mode-btn {
  padding: 7px 22px; border: 2px solid #ffb07a;
  background: #fff8f0; color: #c0380a;
  font-size: 0.82rem; cursor: pointer; transition: all 0.2s;
}
.mode-btn:first-child { border-radius: 50px 0 0 50px; }
.mode-btn:last-child  { border-radius: 0 50px 50px 0; border-left: none; }
.mode-btn.active { background: #e8190a; color: #ffd740; border-color: #e8190a; font-weight: bold; }

.info-box {
  max-width: 640px; margin: 0 auto 4px;
  padding: 8px 16px; border-radius: 12px;
  font-size: 0.75rem; line-height: 1.5; text-align: center;
}
.info-ai    { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
.info-wiki  { background: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb; }
.info-pexels{ background: #fce4ec; color: #880e4f; border: 1px solid #f8bbd0; }

.ai-area {
  display: none; flex-direction: column;
  align-items: center; gap: 10px; padding: 0 20px 12px;
  max-width: 640px; margin: 0 auto;
}
.ai-area.show { display: flex; }
.style-row { display: flex; gap: 6px; flex-wrap: wrap; justify-content: center; }
.style-chip {
  padding: 4px 12px; border-radius: 50px;
  border: 1.5px solid #a5d6a7; background: #f1f8f1;
  color: #2e7d32; font-size: 0.74rem; cursor: pointer; transition: all 0.2s;
}
.style-chip:hover, .style-chip.active { background: #2e7d32; color: white; border-color: #2e7d32; }

.loading {
  display: none; text-align: center;
  padding: 40px; color: #c0380a; font-size: 1rem; letter-spacing: 2px;
}
.spinner {
  display: inline-block; width: 28px; height: 28px;
  border: 3px solid #ffcc80; border-top-color: #e8190a;
  border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 10px;
}
@keyframes spin { to { transform: rotate(360deg); } }
.empty { text-align: center; padding: 40px; color: #c09070; font-size: 0.9rem; }

.gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(155px, 1fr));
  gap: 18px; padding: 16px 22px 40px;
  max-width: 1100px; margin: 0 auto;
}
.phone-card {
  display: flex; flex-direction: column;
  align-items: center; gap: 8px;
  cursor: pointer; transition: transform 0.2s;
}
.phone-card:hover { transform: translateY(-4px); }
.phone-frame {
  position: relative; background: #111;
  border-radius: 22px; border: 3px solid #333;
  overflow: hidden; box-shadow: 0 8px 28px #0004;
  width: 136px; height: 272px;
}
.phone-frame::before {
  content: ''; position: absolute;
  top: 8px; left: 50%; transform: translateX(-50%);
  width: 38px; height: 7px;
  background: #222; border-radius: 10px; z-index: 10;
}
.phone-frame img {
  width: 100%; height: 100%;
  object-fit: cover; display: block;
  opacity: 0; transition: opacity 0.5s;
}
.lock-overlay {
  position: absolute; inset: 0;
  background: linear-gradient(180deg,rgba(0,0,0,.2) 0%,transparent 40%,rgba(0,0,0,.1) 100%);
  display: flex; flex-direction: column;
  align-items: center; padding-top: 26px; z-index: 5;
}
.lock-time { color: #fff; font-weight: 300; text-shadow: 0 1px 6px #0006; letter-spacing: 2px; }
.lock-date { color: rgba(255,255,255,.85); font-size: .5rem; letter-spacing: 1px; margin-top: 2px; }
.home-overlay {
  position: absolute; inset: 0; z-index: 5;
  display: grid; grid-template-rows: 1fr auto;
  padding: 16px 9px 9px; gap: 5px;
}
.app-grid {
  display: grid; grid-template-columns: repeat(4,1fr);
  grid-template-rows: repeat(3,1fr); gap: 5px;
  align-content: start; padding-top: 8px;
}
.app-icon { width: 100%; aspect-ratio: 1; background: rgba(255,200,170,.55); border-radius: 9px; backdrop-filter: blur(4px); }
.dock {
  display: grid; grid-template-columns: repeat(4,1fr); gap: 5px;
  background: rgba(255,190,160,.38); border-radius: 13px;
  padding: 5px; backdrop-filter: blur(8px);
}
.dock-icon { aspect-ratio: 1; background: rgba(255,200,180,.55); border-radius: 9px; }

.card-bottom { display: flex; flex-direction: column; align-items: center; gap: 5px; }
.card-src { font-size: .68rem; color: #a05020; opacity: .8; }
.dl-btn {
  font-size: .72rem; padding: 5px 14px;
  background: linear-gradient(135deg,#ff6b35,#e8190a);
  color: #ffd740; border: none; border-radius: 50px;
  cursor: pointer; box-shadow: 0 2px 8px #e8190a30; transition: transform .15s;
}
.dl-btn:hover { transform: scale(1.05); }

/* img loading skeleton */
.skeleton {
  position: absolute; inset: 0;
  background: linear-gradient(90deg,#f5d5b8 25%,#ffe0c0 50%,#f5d5b8 75%);
  background-size: 200% 100%;
  animation: shimmer 1.2s infinite;
}
@keyframes shimmer { to { background-position: -200% 0; } }

/* MODAL */
.modal-bg {
  display: none; position: fixed; inset: 0;
  background: rgba(0,0,0,.6); z-index: 100;
  align-items: center; justify-content: center;
  backdrop-filter: blur(4px);
}
.modal-bg.open { display: flex; }
.modal {
  background: #fff8f0; border-radius: 24px;
  padding: 26px 22px; max-width: 370px; width: 90%;
  text-align: center; box-shadow: 0 20px 60px #0004; position: relative;
}
.modal-close {
  position: absolute; top: 12px; right: 16px;
  font-size: 1.3rem; color: #c0380a; cursor: pointer; border: none; background: none;
}
.modal h2 { color: #c0380a; font-size: 1rem; letter-spacing: 2px; }
.modal-meta { font-size: .75rem; color: #a05020; margin: 6px 0 12px; }
.modal-phones { display: flex; justify-content: center; gap: 16px; margin: 12px 0; }
.modal-dl-row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-top: 14px; }
.modal-dl-btn {
  padding: 9px 18px; border-radius: 50px;
  border: 2px solid #ffb07a; background: #fff3e0;
  color: #c0380a; font-size: .78rem; cursor: pointer; transition: all .2s;
}
.modal-dl-btn:hover { background: #e8190a; color: #ffd740; border-color: #e8190a; }
.modal-dl-btn.primary {
  background: linear-gradient(135deg,#ff6b35,#e8190a);
  color: #ffd740; border-color: transparent;
}
.modal-credit { font-size: .65rem; color: #b07050; margin-top: 10px; opacity: .8; }
</style>
</head>
<body>

<header>
  <div class="logo-text">ç¦æ°”ç ”ç©¶æ‰€</div>
  <div class="tagline">âœ¦ é«˜æ¸…æ‰‹æœºå£çº¸ Â· æ¯æ—¥å¥½è¿ âœ¦</div>
</header>

<div class="source-tabs">
  <button class="src-tab active" onclick="setSource('ai')"     id="tab-ai">ğŸ¤– AIç”Ÿæˆ <span class="source-badge badge-ai">å…è´¹Â·åŸåˆ›</span></button>
  <button class="src-tab"        onclick="setSource('wiki')"   id="tab-wiki">ğŸ–¼ï¸ ç»å…¸åç”» <span class="source-badge badge-wiki">å…¬å…±ç‰ˆæƒ</span></button>
  <button class="src-tab"        onclick="setSource('pexels')" id="tab-pexels">ğŸ“· æ‘„å½±å¤§ç‰‡ <span class="source-badge badge-pexels">Pexels</span></button>
</div>

<div class="search-section">
  <div class="search-row">
    <input id="searchInput" type="text" placeholder="è¾“å…¥å…³é”®è¯ï¼Œå¦‚ï¼šæ‹›è´¢é”¦é²¤ã€ç‰¡ä¸¹â€¦"/>
    <button onclick="doSearch()">âœ¨ ç”Ÿæˆ</button>
  </div>
  <div class="tag-row" id="tagRow"></div>
  <div class="mode-toggle">
    <button class="mode-btn active" id="btnLock" onclick="setMode('lock')">ğŸ”’ é”å±</button>
    <button class="mode-btn"        id="btnHome" onclick="setMode('home')">ğŸ“± ä¸»å±</button>
  </div>
</div>

<div class="ai-area" id="aiArea">
  <div class="style-row" id="styleRow">
    <span class="style-chip active" onclick="styleClick(this,'oil painting style')">ğŸ–¼ æ²¹ç”»</span>
    <span class="style-chip" onclick="styleClick(this,'watercolor art')">ğŸ¨ æ°´å½©</span>
    <span class="style-chip" onclick="styleClick(this,'Chinese ink wash painting')">ğŸ–Œ æ°´å¢¨</span>
    <span class="style-chip" onclick="styleClick(this,'dreamy soft aesthetic')">âœ¨ æ¢¦å¹»</span>
    <span class="style-chip" onclick="styleClick(this,'minimalist')">ğŸ¤ æç®€</span>
  </div>
</div>

<div id="infoBox" class="info-box info-ai">
  ğŸ¤– ç”± Pollinations.ai å…è´¹ç”Ÿæˆ Â· å®Œå…¨åŸåˆ› Â· é›¶æˆæœ¬ Â· å¯å•†ç”¨
</div>

<div class="loading" id="loading">
  <div class="spinner"></div><br/><span id="loadingText">æ­£åœ¨ç”Ÿæˆå¥½è¿å£çº¸â€¦</span>
</div>
<div class="gallery" id="gallery">
  <div class="empty">é€‰æ‹©æ ‡ç­¾æˆ–è¾“å…¥å…³é”®è¯ï¼Œå¼€å§‹ç”Ÿæˆå£çº¸ âœ¨</div>
</div>

<!-- MODAL -->
<div class="modal-bg" id="modalBg" onclick="closeModalBg(event)">
  <div class="modal">
    <button class="modal-close" onclick="document.getElementById('modalBg').classList.remove('open')">âœ•</button>
    <h2 id="modalTitle">ğŸŒ¸ ä¸‹è½½å£çº¸</h2>
    <div class="modal-meta" id="modalMeta"></div>
    <div class="modal-phones" id="modalPhones"></div>
    <div class="modal-dl-row">
      <button class="modal-dl-btn" onclick="downloadImg('lock')">ä¸‹è½½é”å±ç‰ˆ</button>
      <button class="modal-dl-btn" onclick="downloadImg('home')">ä¸‹è½½ä¸»å±ç‰ˆ</button>
      <button class="modal-dl-btn primary" onclick="downloadImg('both')">â¬‡ æˆå¥—ä¸‹è½½</button>
    </div>
    <div class="modal-credit" id="modalCredit"></div>
  </div>
</div>

<script>
// â”€â”€ é…ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PEXELS_KEY = 'NqZqwTAmf3Y3VxDtIsaXzJYjWafZDXUDUPzgUcv6E1oOkL7Csq8Ha2uN';
// Pollinations.ai & Wikimedia æ— éœ€ key
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let currentSource = 'ai';
let currentMode   = 'lock';
let currentStyle  = 'oil painting style';
let currentImages = [];
let selectedImg   = null;

const TAGS = {
  ai: ['ğŸŒ¸ å¤å…¸èŠ±å‰','ğŸŸ æ‹›è´¢é”¦é²¤','ğŸŒº ç‰¡ä¸¹å¯Œè´µ','ğŸŒŒ æ˜Ÿç©ºé“¶æ²³','ğŸ€ å¹¸è¿å››å¶è‰','ğŸ”´ çº¢è‰²é”¦é²¤','â˜¯ ç¦…æ„æ°´å¢¨','ğŸŒ™ æœˆå…‰ä»™å¢ƒ'],
  wiki: ['ğŸŒ» æ¢µé«˜å‘æ—¥è‘µ','ğŸŒŠ è‘›é¥°åŒ—æ–‹','ğŸŒ¹ è«å¥ˆç¡è²','ğŸŒ¸ æ—¥æœ¬æµ®ä¸–ç»˜','ğŸ¦ å¢æ¢­ä¸›æ—','ğŸŒ… é€çº³æ—¥è½','ğŸ› å¤å…¸é™ç‰©','ğŸŒ¿ æ¤ç‰©ç”»'],
  pexels: ['ğŸŒ¸ èŠ±å‰ç‰¹å†™','ğŸ” äº‘æµ·å±±å·','ğŸŒŠ æµ·æµªæ²™æ»©','ğŸŒƒ åŸå¸‚å¤œæ™¯','ğŸ‚ ç§‹æ—¥æ£®æ—','â„ å†¬æ—¥é›ªæ™¯','ğŸŒ¿ ç»¿æ¤æ¸…æ–°','ğŸš æç®€è´¨æ„Ÿ'],
};

// Pollinations AI å…³é”®è¯æ˜ å°„ï¼ˆè‹±æ–‡æ•ˆæœæ›´å¥½ï¼‰
const AI_PROMPT_MAP = {
  'ğŸŒ¸ å¤å…¸èŠ±å‰': 'classical baroque flowers bouquet dark background',
  'ğŸŸ æ‹›è´¢é”¦é²¤': 'lucky koi fish golden red swimming Chinese auspicious',
  'ğŸŒº ç‰¡ä¸¹å¯Œè´µ': 'peony flowers Chinese traditional wealthy auspicious',
  'ğŸŒŒ æ˜Ÿç©ºé“¶æ²³': 'milky way galaxy starry night sky purple blue',
  'ğŸ€ å¹¸è¿å››å¶è‰': 'four leaf clover lucky green nature',
  'ğŸ”´ çº¢è‰²é”¦é²¤': 'red koi fish water lily Chinese lucky',
  'â˜¯ ç¦…æ„æ°´å¢¨': 'Chinese zen ink wash painting bamboo mountain misty',
  'ğŸŒ™ æœˆå…‰ä»™å¢ƒ': 'moonlight fantasy dreamy ethereal lotus pond',
};

const WIKI_SEARCHES = {
  'ğŸŒ» æ¢µé«˜å‘æ—¥è‘µ':  'Sunflowers Van Gogh 1888',
  'ğŸŒŠ è‘›é¥°åŒ—æ–‹':    'Great Wave Kanagawa Hokusai',
  'ğŸŒ¹ è«å¥ˆç¡è²':    'Water Lilies Claude Monet',
  'ğŸŒ¸ æ—¥æœ¬æµ®ä¸–ç»˜':  'Japanese ukiyo-e woodblock print flower',
  'ğŸ¦ å¢æ¢­ä¸›æ—':    'Henri Rousseau jungle tiger',
  'ğŸŒ… é€çº³æ—¥è½':    'Joseph Turner sunset seascape',
  'ğŸ› å¤å…¸é™ç‰©':    'Dutch Golden Age still life flowers painting',
  'ğŸŒ¿ æ¤ç‰©ç”»':      'botanical illustration vintage flowers',
};

const PEXELS_SEARCHES = {
  'ğŸŒ¸ èŠ±å‰ç‰¹å†™': 'flowers close up macro',
  'ğŸ” äº‘æµ·å±±å·': 'mountain mist clouds landscape',
  'ğŸŒŠ æµ·æµªæ²™æ»©': 'ocean waves beach',
  'ğŸŒƒ åŸå¸‚å¤œæ™¯': 'city lights night',
  'ğŸ‚ ç§‹æ—¥æ£®æ—': 'autumn forest golden',
  'â„ å†¬æ—¥é›ªæ™¯':  'winter snow scenery',
  'ğŸŒ¿ ç»¿æ¤æ¸…æ–°': 'green plants minimalist',
  'ğŸš æç®€è´¨æ„Ÿ': 'minimalist texture abstract',
};

// â”€â”€ Source & Style â”€â”€
function setSource(src) {
  currentSource = src;
  ['ai','wiki','pexels'].forEach(s =>
    document.getElementById(`tab-${s}`).classList.toggle('active', s===src)
  );
  document.getElementById('aiArea').classList.toggle('show', src==='ai');

  const info = document.getElementById('infoBox');
  const configs = {
    ai:     { cls:'info-ai',     txt:'ğŸ¤– ç”± Pollinations.ai å…è´¹ç”Ÿæˆ Â· å®Œå…¨åŸåˆ› Â· é›¶æˆæœ¬ Â· å¯å•†ç”¨' },
    wiki:   { cls:'info-wiki',   txt:'ğŸ–¼ å›¾ç‰‡æ¥è‡ª Wikimedia Commons Â· å…¬å…±ç‰ˆæƒï¼ˆPublic Domainï¼‰Â· å¯å…è´¹å•†ç”¨' },
    pexels: { cls:'info-pexels', txt:'ğŸ“· å›¾ç‰‡æ¥è‡ª Pexels Â· Pexels License Â· å…è®¸å•†ä¸šä½¿ç”¨' },
  };
  info.className = 'info-box ' + configs[src].cls;
  info.textContent = configs[src].txt;
  renderTags();
  currentImages = [];
  document.getElementById('gallery').innerHTML = '<div class="empty">é€‰æ‹©æ ‡ç­¾æˆ–è¾“å…¥å…³é”®è¯ âœ¨</div>';
}

function styleClick(el, style) {
  document.querySelectorAll('.style-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  currentStyle = style;
}

function setMode(m) {
  currentMode = m;
  document.getElementById('btnLock').classList.toggle('active', m==='lock');
  document.getElementById('btnHome').classList.toggle('active', m==='home');
  renderGallery();
}

function renderTags() {
  const row = document.getElementById('tagRow');
  row.innerHTML = '';
  TAGS[currentSource].forEach((t,i) => {
    const el = document.createElement('span');
    el.className = 'tag' + (i===0?' active':'');
    el.textContent = t;
    el.onclick = () => tagClick(el, t);
    row.appendChild(el);
  });
}

function tagClick(el, kw) {
  document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('searchInput').value = kw;
  doSearch();
}

// â”€â”€ SEARCH â”€â”€
async function doSearch() {
  const raw = document.getElementById('searchInput').value.trim();
  if (!raw) return;
  showLoading(true);
  document.getElementById('gallery').innerHTML = '';
  try {
    if      (currentSource==='ai')     await fetchAI(raw);
    else if (currentSource==='wiki')   await fetchWiki(raw);
    else                               await fetchPexels(raw);
  } catch(e) {
    console.error(e);
    document.getElementById('gallery').innerHTML = '<div class="empty">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯• ğŸŒ¸</div>';
  }
  showLoading(false);
}

function showLoading(on) {
  document.getElementById('loading').style.display = on ? 'block' : 'none';
}

// â”€â”€ AI: Pollinations.ai â”€â”€
// å®Œå…¨å…è´¹ï¼Œæ— éœ€API Keyï¼Œç›´æ¥URLç”Ÿæˆå›¾ç‰‡
async function fetchAI(kw) {
  const prompt = AI_PROMPT_MAP[kw] || kw;
  const fullPrompt = `${prompt}, ${currentStyle}, phone wallpaper, vertical portrait, highly detailed, beautiful, 4K, no text`;

  // Pollinations.ai: æ¯ä¸ªseedç”Ÿæˆä¸åŒå˜ä½“
  const imgs = Array.from({length:8}, (_,i) => {
    const seed = Math.floor(Math.random()*99999) + i*1000;
    const encodedPrompt = encodeURIComponent(fullPrompt);
    const url = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=768&height=1366&seed=${seed}&nologo=true`;
    return {
      id: i, url, thumb: url,
      alt: kw, source: 'ai',
      credit: 'Pollinations.ai Â· å…è´¹AIç”Ÿæˆ',
      author: 'ç¦æ°”ç ”ç©¶æ‰€',
    };
  });
  currentImages = imgs;
  renderGallery();
}

// â”€â”€ Wiki: Wikimedia Commons â”€â”€
async function fetchWiki(kw) {
  const q = WIKI_SEARCHES[kw] || kw;
  document.getElementById('loadingText').textContent = 'æ­£åœ¨æœç´¢åç”»â€¦';

  try {
    const searchRes = await fetch(
      `https://commons.wikimedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(q)}&srnamespace=6&srlimit=12&format=json&origin=*`
    );
    const searchData = await searchRes.json();
    const hits = searchData?.query?.search || [];
    if (!hits.length) throw new Error('no results');

    const titles = hits.slice(0,8).map(h=>h.title).join('|');
    const infoRes = await fetch(
      `https://commons.wikimedia.org/w/api.php?action=query&titles=${encodeURIComponent(titles)}&prop=imageinfo&iiprop=url|extmetadata&iiurlwidth=800&format=json&origin=*`
    );
    const infoData = await infoRes.json();
    const pages = Object.values(infoData?.query?.pages||{});

    const imgs = pages
      .filter(p => p.imageinfo?.[0]?.thumburl)
      .map((p,i) => ({
        id: i,
        url:   p.imageinfo[0].url,
        thumb: p.imageinfo[0].thumburl,
        alt:   (p.title||kw).replace('File:','').replace(/\.[^.]+$/,''),
        source:'wiki',
        credit:'Wikimedia Commons Â· Public Domain',
        author: (p.imageinfo[0].extmetadata?.Artist?.value||'').replace(/<[^>]*>/g,'') || 'å…¬å…±ç‰ˆæƒ',
      }));

    currentImages = imgs.length ? imgs : getFallback(kw,'wiki');
  } catch {
    currentImages = getFallback(kw,'wiki');
  }
  renderGallery();
}

// â”€â”€ Pexels â”€â”€
async function fetchPexels(kw) {
  const q = PEXELS_SEARCHES[kw] || kw;
  document.getElementById('loadingText').textContent = 'æ­£åœ¨æœç´¢æ‘„å½±ä½œå“â€¦';

  try {
    const res = await fetch(
      `https://api.pexels.com/v1/search?query=${encodeURIComponent(q)}&per_page=12&orientation=portrait`,
      { headers: { Authorization: PEXELS_KEY } }
    );
    const data = await res.json();

    currentImages = (data.photos||[]).map((p,i) => ({
      id: p.id,
      url:   p.src.original,
      thumb: p.src.large,
      alt:   p.alt || kw,
      source:'pexels',
      credit:`Pexels Â· ${p.photographer}`,
      author: p.photographer,
      pexelsUrl: p.url,
    }));

    if (!currentImages.length) currentImages = getFallback(kw,'pexels');
  } catch(e) {
    console.error(e);
    currentImages = getFallback(kw,'pexels');
  }
  renderGallery();
}

function getFallback(kw, src) {
  return Array.from({length:6},(_,i)=>({
    id:i, url:`https://picsum.photos/seed/${src}${kw}${i}/1080/1920`,
    thumb:`https://picsum.photos/seed/${src}${kw}${i}/400/800`,
    alt:kw, source:src, credit:'ç¤ºä¾‹å›¾ç‰‡', author:'',
  }));
}

// â”€â”€ RENDER â”€â”€
function renderGallery() {
  const g = document.getElementById('gallery');
  g.innerHTML = '';
  if (!currentImages.length) {
    g.innerHTML = '<div class="empty">æ²¡æœ‰æ‰¾åˆ°ç»“æœï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯• ğŸŒ¸</div>';
    return;
  }
  currentImages.forEach(img => {
    const card = document.createElement('div');
    card.className = 'phone-card';
    card.onclick = () => openModal(img);

    const frame = makePhoneFrame(img, currentMode, 136, 272);
    const bottom = document.createElement('div');
    bottom.className = 'card-bottom';
    const srcLabel = {ai:'ğŸ¤– AIåŸåˆ›', wiki:'ğŸ–¼ åç”»', pexels:'ğŸ“· æ‘„å½±'}[img.source];
    bottom.innerHTML = `<span class="card-src">${srcLabel}</span>`;
    const dlBtn = document.createElement('button');
    dlBtn.className = 'dl-btn';
    dlBtn.textContent = 'â¬‡ æˆå¥—ä¸‹è½½';
    dlBtn.onclick = e => { e.stopPropagation(); openModal(img); };
    bottom.appendChild(dlBtn);

    card.appendChild(frame);
    card.appendChild(bottom);
    g.appendChild(card);
  });
}

function makePhoneFrame(img, mode, w, h) {
  const frame = document.createElement('div');
  frame.className = 'phone-frame';
  frame.style.width = w+'px';
  frame.style.height = h+'px';

  // skeleton loader
  const sk = document.createElement('div');
  sk.className = 'skeleton';
  frame.appendChild(sk);

  const im = document.createElement('img');
  im.src = img.thumb;
  im.alt = img.alt;
  im.onload  = () => { im.style.opacity='1'; sk.style.display='none'; };
  im.onerror = () => {
    im.src = `https://picsum.photos/seed/err${img.id}/400/800`;
    im.style.opacity='1'; sk.style.display='none';
  };
  frame.appendChild(im);

  if (mode === 'lock') {
    const ov = document.createElement('div');
    ov.className = 'lock-overlay';
    const now = new Date();
    const hh = String(now.getHours()).padStart(2,'0');
    const mm = String(now.getMinutes()).padStart(2,'0');
    const sz = w < 120 ? '1.1rem' : '1.5rem';
    ov.innerHTML = `<div class="lock-time" style="font-size:${sz}">${hh}:${mm}</div><div class="lock-date">February 22, Saturday</div>`;
    frame.appendChild(ov);
  } else {
    const ov = document.createElement('div');
    ov.className = 'home-overlay';
    let html = '<div class="app-grid">';
    for(let j=0;j<12;j++) html += '<div class="app-icon"></div>';
    html += '</div><div class="dock">';
    for(let j=0;j<4;j++) html += '<div class="dock-icon"></div>';
    html += '</div>';
    ov.innerHTML = html;
    frame.appendChild(ov);
  }
  return frame;
}

// â”€â”€ MODAL â”€â”€
function openModal(img) {
  selectedImg = img;
  document.getElementById('modalTitle').textContent = `ğŸŒ¸ ${img.alt||'ä¸‹è½½å£çº¸'}`;
  document.getElementById('modalMeta').textContent = img.credit||'';
  document.getElementById('modalCredit').textContent =
    img.source==='wiki'   ? 'âœ… Wikimedia Commons å…¬å…±ç‰ˆæƒï¼Œå¯å•†ç”¨' :
    img.source==='pexels' ? 'âœ… Pexels Licenseï¼Œå¯å•†ç”¨ï¼Œæ— éœ€æ ‡æ³¨' :
                            'âœ… AIåŸåˆ›ç”Ÿæˆï¼Œç‰ˆæƒå½’æœ¬åº—æ‰€æœ‰ï¼Œå¯å•†ç”¨';

  const mp = document.getElementById('modalPhones');
  mp.innerHTML = '';
  ['lock','home'].forEach(m => mp.appendChild(makePhoneFrame(img, m, 100, 200)));
  document.getElementById('modalBg').classList.add('open');
}

function closeModalBg(e) {
  if (e.target===document.getElementById('modalBg'))
    document.getElementById('modalBg').classList.remove('open');
}

// â”€â”€ DOWNLOADï¼ˆCanvasåˆæˆï¼‰â”€â”€
async function downloadImg(type) {
  if (!selectedImg) return;
  const modes = type==='both' ? ['lock','home'] : [type==='lock'?'lock':'home'];

  for (const m of modes) {
    await canvasDownload(selectedImg, m);
  }
  document.getElementById('modalBg').classList.remove('open');
}

async function canvasDownload(img, mode) {
  const W = 1080, H = 1920;
  const canvas = document.createElement('canvas');
  canvas.width = W; canvas.height = H;
  const ctx = canvas.getContext('2d');

  // åŠ è½½å›¾ç‰‡
  const image = new Image();
  image.crossOrigin = 'anonymous';
  await new Promise((res,rej) => {
    image.onload = res;
    image.onerror = rej;
    image.src = img.url;
  }).catch(() => {});

  // ç»˜åˆ¶èƒŒæ™¯å›¾ï¼ˆcover fitï¼‰
  if (image.complete && image.naturalWidth) {
    const scale = Math.max(W/image.naturalWidth, H/image.naturalHeight);
    const sw = image.naturalWidth*scale, sh = image.naturalHeight*scale;
    ctx.drawImage(image, (W-sw)/2, (H-sh)/2, sw, sh);
  } else {
    ctx.fillStyle = '#1a0a02';
    ctx.fillRect(0,0,W,H);
  }

  // é”å±ï¼šå åŠ æ—¶é—´
  if (mode==='lock') {
    ctx.fillStyle='rgba(0,0,0,0.18)';
    ctx.fillRect(0,0,W,H*0.35);
    const now = new Date();
    const hh=String(now.getHours()).padStart(2,'0');
    const mm=String(now.getMinutes()).padStart(2,'0');
    ctx.fillStyle='rgba(255,255,255,0.92)';
    ctx.font='bold 180px -apple-system,sans-serif';
    ctx.textAlign='center';
    ctx.fillText(`${hh}:${mm}`, W/2, 420);
    ctx.font='52px -apple-system,sans-serif';
    ctx.fillStyle='rgba(255,255,255,0.75)';
    ctx.fillText('February 22, Saturday', W/2, 510);
  }

  // ä¸‹è½½
  const a = document.createElement('a');
  a.href = canvas.toDataURL('image/jpeg',0.92);
  a.download = `ç¦æ°”ç ”ç©¶æ‰€_${mode==='lock'?'é”å±':'ä¸»å±'}_${img.alt}.jpg`;
  a.click();
}

// â”€â”€ INIT â”€â”€
window.onload = () => {
  renderTags();
  document.getElementById('searchInput').value = TAGS.ai[0];
  document.getElementById('aiArea').classList.add('show');
  doSearch();
};
</script>
</body>
</html>